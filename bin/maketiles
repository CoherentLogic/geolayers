#!/bin/bash

# i = id
# f = tiff file
# e = email

TEMP=$(getopt -o i:f:e:m:M:  --long id:,file:,email:,minzoom:,maxzoom: -n 'maketiles' -- "$@")
eval set -- "$TEMP"

while true
do
    case "$1" in
	-i|--id)
	    ID=$2
	    shift 2
	    ;;
	-m|--minzoom)
		MINZOOM=$2
		shift 2
		;;
	-M|--maxzoom)
		MAXZOOM=$2
		shift 2
		;;
	-f|--file)
	    FILE=$2
	    shift 2
	    ;;
	-e|--email)
	    EMAIL=$2
	    shift 2
	    ;;
	--)
	    shift
	    break
	    ;;
    esac
done



BASEPATH=/home/geodigraph/webapps/maps/pool/tiles/${ID}

mkdir -p ${BASEPATH}

STARTFILE="${BASEPATH}/START.GL8"
ENDFILE="${BASEPATH}/END.GL8"
STATFILE="${BASEPATH}/STAT.GL8"
IDFILE="${BASEPATH}/ID.GL8"

echo ${ID} > ${IDFILE}

echo "Post-Processing" > ${STATFILE}

date > ${STARTFILE}

/usr/bin/gdal2tiles.py -z ${MINZOOM}-${MAXZOOM} -w none ${FILE} ${BASEPATH}

exit $?
